## 第四章 IP协议

### 基础知识

IP（IPv4、IPv6）相当于OSI参考模型的第3层——网络层

网络层的主要作用是“实现终端节点之间的通信”。这种终端节点之间的通信也叫做“点对点（end-to-end）通信”。

IP大致分为三大作用模块，它们是IP寻址、路由以及IP分包与组包。

### IP地址的基础知识

#### IP地址的定义

IP地址（IPv4）由32位正整数来表示。IP地址在计算机内部以二进制的方式被处理。然而，由于人类社会并不习惯于采用二进制方式，需要将32位的IP地址以每8位为一组，分成4组，每组以 ”，“ 隔开，再将每组数转换为十进制数。

```
将表示成IP地址的数字整体计算，会得出以下数值：
	2^32 = 4 294 967 296
从这个计算结果可知，最多可以允许43亿台计算机连接到网络
```

<div>
    <image src="../res/img/4.ip1.png"></image>
</div>

#### IP地址由网络和主机两部分标识组成

如下图所示，网络标识在数据链路的每个段配置不同的值。网络标识必须保证相互连接的每个段的地址不相重复。

那么，究竟从第几位开始到第几位算是网络标识，又从第几位到第几位算术主机标识呢？目前主要通过子网掩码区分。不过有些情况下依据部分功能、系统和协议需求。

<div>
    <image src="../res/img/4.ip2.png"></image>
</div>

#### IP地址的分类

IP地址分为四个级别，分别为A类、B类、C类、D类。它根据IP地址中从第1位到第4位的比特列对其网络标识和主机标识进行区分。

**A类地址**

A类IP地址是首位以 ”0“ 开头的地址。从第1位到第8位是他的网络标识。A类地址的后24位相当于主机标识。

**B类地址**

B类IP地址是前两位为 “10” 的地址。从第1位到第16位是他的网络标识。B类地址的后16位相当于主机标识。

**C类地址**

C类IP地址是前两位为 “110” 的地址。从第1位到第24位是他的网络标识。B类地址的后8位相当于主机标识。

**C类地址**

D类IP地址是前两位为 “1110” 的地址。从第1位到第32位是他的网络标识。D类地址没有主机标识，常用于多播。

#### 子网掩码

一个IP地址只要确定了其分类，也就确定了它的网络标识和主机标识。由此，按照每个分类所标识的范围如下所示：

```
A类	11111111.00000000.00000000.00000000
B类	11111111.11111111.00000000.00000000
C类	11111111.11111111.11111111.00000000
```

直接使用A、B、C类地址显得浪费资源，为此，人们已经开始一种新的组合方式以减少这种浪费。

**子网与子网掩码**

现在，一个IP地址的网络标识和主机标识已不再受限于该地址的类型，而是有一个叫做 “子网掩码” 的识别码通过子网网络地址细分出比A类、B类、C类更小粒度的网络。这种方式实际上就是讲原来A类、B类、C类等分类中的主机地址部分用作子网地址，可以将原网络分为多个物理网络的一种机制。