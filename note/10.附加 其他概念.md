## 概念详解

### 二层交换机、三层交换机、路由器

#### 二层交换技术

二层交换技术是发展比较成熟，二层交换机属**数据链路层**设备，可以识别数据包中的**MAC地址**信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。

具体工作流程为：

1. 当交换机从某个端口收到一个数据包，它先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上的
2. 再去读取包头中的目的MAC地址，并在地址表中查找相应的端口；
3. 如表中有与这目的MAC地址对应的端口，把数据包直接复制到这端口上
4. 如表中找不到相应的端口则把数据包广播到所有端口上，当目的机器对源机器回应时，交换机又可以学习一目的MAC地址与哪个端口对应，在下次传送数据时就不再需要对所有端口进行广播了。

不断的循环这个过程，对于全网的MAC地址信息都可以学习到，二层交换机就是这样建立和维护它自己的地址表。

#### 三层交换技术

第三层交换工作在OSI七层网络模型中的第三层即网络层，是利用第三层协议中的IP包的包头信息来对后续数据业务流进行标记，具有同一标记的业务流的后续报文被交换到第二层数据链路层，从而打通源IP地址和目的IP地址之间的一条通路。这条通路经过第二层链路层。有了这条通路，三层交换机就没有必要每次将接收到的数据包进行拆包来判断路由，而是直接将数据包进行转发，将数据流进行交换。

#### 路由器和三层交换机的区别

路由器是三层设备，可是三层交换机却可以同时工作在三层和二层的。

1. 接口形态：路由器用于连接运营商，运营商甩给用户的线路可以有ATM、POS、CPOS、以太网等多种线路，路由器都需要支持；而我们平时所说的三层交换机一般只支持以太网接口，接口数量非常多（毕竟用在园区内部）
2. 功能：路由器用于园区出口，承担访问互联网的功能，支持NAT/IPSEC等功能；这些功能90%的三层交换机是不支持的。
3. 性能：三层交换机组建的是内部高速路，到了出口路由器就进入国道了。交换机上10G/40G/100G接口都可以灵活扩展；而一般园区网出口路由器不需要太高性能，够用即可，就算插个100G板卡，也买不起运营商100G链路
4. 成本：高端路由器比高端交换机价格贵，路由器单接口成本也更高。支持500个接口的交换机很多，但能有500个接口的路由器已经非常贵了。

### 子网掩码 网关

#### 子网掩码

子网掩码(subnet mask)又叫网络掩码、地址掩码、子网络遮罩，它是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。

> 常用的子网掩码有数百种，这里只介绍最常用的两种子网掩码。

- 子网掩码是“255.255.255.0”的网络：
  最后面一个数字可以在0~255范围内任意变化，因此可以提供256个IP地址。但是实际可用的IP地址数量是256-2，即254个，因为主机号不能全是“0”或全是“1”。
- 子网掩码是“255.255.0.0”的网络：
  后面两个数字可以在0~255范围内任意变化，可以提供255²个IP地址。但是实际可用的IP地址数量是255²-2，即65023个。

#### 网关

网关（Gateway）就是一个网络连接到另一个网络的“关口”。也就是网络关卡。网关的作用就是实现两个网络之间进行通讯与控制。

网关设备可以是 交换机（三层及以上才能跨网络）、路由器、启用了路由协议的服务器、代理服务器、防火墙等

网关地址就是网关设备的IP地址。



